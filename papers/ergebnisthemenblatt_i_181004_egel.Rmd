---
lang: de-DE
title: |
    | Ergebnisthemenblätter NOVANIMAL
    | Quasi-Experiment in zwei Hochschulmensen: Auswertungen der Menü-Verkäufe
author: "Gian-Andrea Egeler, Priska Baur"
date: "`r format(Sys.Date(), '%B %Y')`"
output:
  pdf_document: 
    fig_caption: yes
fontsize: 12pt
geometry: margin = 1.2in
header-includes:
- \usepackage{fancyhdr} # for haeders and footers
- \usepackage{setspace} # line space
- \onehalfspacing # for onehalfspacing between lines (from package setspace)
- \usepackage{float} # for graphics
- \usepackage{graphicx} # for graphics
- \usepackage[font=small,labelfont=bf]{caption} # for caption content small and bold Figure

bibliography: biblio_181004.bib # apa style is not working, reasons?

link-citations: true # for linking the citations in text
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = F, warning = F, error = F, message = F, fig.align='center', fig.pos ='H')

library(apa) # for reporting apa style for e.g. chisquare test

#rmarkdown::render("papers/ergebnisthemenblatt_i_181004_egel.Rmd", output_format = "pdf_document", encoding="LATIN1") # here is the code to knitr the rmd file in the environment (takes data already load, otherwise many errors occur)

#xaringan::inf_mr() # LiveReload: a technology that enables you to live preview the output as soon as you save the source document, and you do not need to hit the Knit button => is not working on that machine (due to encoding)

# attention function is dark causes problems, run that first into the environment
# parindent causes some errors dont know the reason
```


###	1. Lead / Teaser

Die zentrale Bedeutung tierischer Produkte spiegelt sich im Angebot der Gastronomie. Im Jahr 2015 sind Fleischgerichte (20.3%) mit den entsprechenden Beilagen (30.8%) im Zusammenhang der Ausser-Haus-Verpflegung die meistkonsumierten Speisen in der Schweiz [@gastrosuisse_branchenspiegel_2016]. Gemäss der ersten in den Jahren 2014/2015 durchgeführten nationalen Ernährungserhebung menuCH essen 70 % der Bevölkerung zwischen 18 und 75 Jahren am Mittag auswärts [@bochud_anthropometric_2017]. Daher rückt die Gemeinschaftsgastronomie als zentraler Akteur einer innovativen und nachhaltigen Ernährungswirtschaft ins Blickfeld. Welche Innovationen in der Gemeinschaftsgastronomie könnten dazu beitragen, den Pro-Kopf-Verbrauch an tierischen Nahrungsmitteln zu senken?

###	2. Forschungsfragen und Ziele

Die übergeordnete Forschungsfrage dieses Arbeitspackets WPIII.1 war es, die Gäste in Mensen dazu zu bewegen, häufiger ressourcenschonende vegetarische^[vegetarisch = ovo-lakto-vegetarisch (inkl. Eier und Milch)] oder vegane^[vegan = ausschliesslich pflanzliche Zustaten] Gerichte zu wählen. Die abgeleitete Forschungsfragen interessiert es wie das Menü-Angebot oder die Menü-Beschriftung die Menü-Wahl aller Mensabesucher beeinflusst?

\newpage

###	3. Theoretischer Hintergrund und Methoden 

Zusammen mit den Praxispartnern, einem Catering Unternehmen und dem Facility Management einer Hochschule, wurde ein Quasi-Experiment vorbereitet, das als Pilotversuch in zwei Hochschulmensen durchgeführt wird. Konkret wird untersucht, wie die Gäste auf ein verändertes Menü-Angebot mit einem höheren Anteil an ressourcenschonenden vegetarischen oder veganen Gerichten reagieren. 
\par
Das Quasi-Experiment findet im Herbstsemester (HS) 2017 während 12 Wochen statt und bestand aus zwei Mensazyklen à 6 Wochen (siehe Abbildung \ref{fig:fig1}). In den 6 Referenz- bzw. Basiswochen wurden zwei fleisch- oder fischhaltige Gerichte und ein vegetarisches Gericht angeboten. In den 6 Interventionswochen wurde das Verhältnis umgekehrt und es wurden ein veganes, ein vegetarisches und ein fleisch- oder fischhaltiges Gericht angeboten. Beim veganen Angebot wurde zwischen eigenständige authenische Gerichte (z. B. Linsen-Dal) und vegane Gerichte mit Fleischsubstituten (z. B. Quornragout) unterschieden. Basis- und Interventionsangebote wechselten wöchentlich ab. Während der gesamten 12 Wochen konnten die Gäste jeweils auf ein Buffet ausweichen und ihre Mahlzeit aus warmen und kalten Komponenten selber zusammenstellen. 
\par
Die nachfolgenden Analysen und Ergebnisse basieren auf Daten aus den Kassensystemen des Catering Unternehmens. Für die Analysen sind insgesamt mehr als 26'000 Transaktionen ( resp. Menü-Käufe) während der Mittagszeit berücksichtigt worden.

```{r, fig.cap="\\label{fig:fig1} Die Abbildung 1 zeigt das Versuchsdesign der ersten 6 Experimentwochen (Kalenderwochen 40 bis 45).", out.width = '100%', dpi=200}
knitr::include_graphics("design_eng_experiment_ohne datum_180426_03egel.png")
```

###	4. Ergebnisse

#### 4.1 Was wurde angeboten?

Von insgesamt 93 verschiedenen Gerichten, welche über zwei Mensazyklen^[ein Zyklus besteht aus 6 Wochen, danach wiederholen sich die Gerichten] verteilt angeboten wurden, enthielten `r round((45/93)*100, digits = 0)` Prozent (*n* = 45) der Gerichte Fleisch. Ein Drittel (*n* = 31) der Gerichte wurde vegetarisch und die restlichen `r round((16/93)*100, digits = 0)` Prozent (*n* = 16) ausschliesslich pflanzlich angeboten.
\par
90 verschiedenen Mahlzeiten wurden pro Mensa und Mensazyklus auf drei Menü-Linien (Favorite, Kitchen und World) angeboten. Wird das gesamte Angebot (zwei Mensazyklen) auf beide Mensen und über alle Tage addiert, ergibt das ein geplantes Angebot von 360 Gerichten^[90 Gerichte x 2 Mensazyklen x 2 Mensen]. Aus betrieblichen Gründen kam es beim Catering Unternehmen des Öfteren zu Zusatzangeboten, welche das geplante Angebot zusätzlich vergrösserte. In den 12 Wochen wurden zu den total geplanten 360 Gerichten noch 120 Gerichten zusätzlich angeboten (siehe Abbildung \ref{fig:fig2}).

```{r, results='hide'}
# show aggregated total meal offer (N = 480 or 596 without NA's)
# exclude hot and cold
t0 <- filter(info_orig, !grepl("Hot and Cold", info_orig$label_content)) %>% group_by(label_content, condit) %>% summarise(tot = n()) %>% ungroup() %>% group_by(condit) %>% mutate(pct = tot/sum(tot))  

# show aggregated offer without locals (N = 360)
p0 <- filter(info_orig, !grepl("Local ", info_orig$article_description) & !grepl("Hot and Cold", info_orig$label_content)) %>% group_by(label_content, condit) %>% summarise(tot = n()) %>% ungroup() %>% group_by(condit) %>% mutate(pct = tot/sum(tot))

# chi-square to compare if the two meals offer (total meal and planed meal offer) differs
# drop unknown meal offers for chi_square test
t <- drop_na(t0) %>% group_by(label_content) %>% summarise(tot = sum(tot)) %>% mutate(pct = tot/sum(tot)) 
p <- group_by(p0, label_content) %>% summarise(tot = sum(tot)) %>% mutate(pct = tot/sum(tot))

tp <- tibble(label = unique(t$label_content), t$tot, p$tot)

# chisquare not significant
chi_s <- chisq.test(t$tot, p = p$pct) # test against expected probability (= which is the planed meal offer)
fisher.test(tp[ ,2:3]) # exact p-value via fisher.test

# chi-square to compare if the two meals offer differ accodring condition 
# start code from the start again
tp0 <- drop_na(t0) %>% select(-pct) %>% bind_cols(., p0[c("tot")]) %>% rename( real_offer = tot, planed_offer = tot1)

# basis
tp1 <- filter(tp0, condit == "Basis") %>% mutate(pct_exp = planed_offer / sum(planed_offer), 
                                               pct_real = real_offer / sum(real_offer))

chi_s2 <- chisq.test(tp1$real_offer, p = tp1$pct_exp) # check if expected frequencies are over 5
fisher.test(tp1[ ,3:4]) # for exact p-value, it differs strongly form the p-value from chi-square 

#interventionswochen
tp1 <- filter(tp0, condit == "Intervention") %>% mutate(pct_exp = planed_offer / sum(planed_offer), pct_real = real_offer / sum(real_offer))
chi_s3 <- chisq.test(tp1$real_offer, p = tp1$pct_exp) # check if expected frequencies are over 5
fisher.test(tp1[ ,3:4]) # for exact p-value, it differs strongly form the p-value from 

```

```{r, fig.cap="\\label{fig:fig2} Die Abbildung zeigt das geplante (*n* = 480) und angebotene Angebot (*n* = 600) für ein ganzes Herbstsemester (60 Tage) und zwei Hochschulmensen nach den fünf Menü-Inhalten", fig.height=10, fig.width=14}
# plot real and planed offer
##prepare data
# target for 2015 and 2016 and 2017 for both canteens (per canteen 120 meals) and for both cycles: 480 melas in total
# per canten and cycle: meat:54 (30 + 30*.8), vegetarian:36, hot and cold: 30

df_plan_56 <- tibble(year = rep(2015, times=360, each=1),
                     label_content = rep(c("Fleisch","Vegetarisch"), times=c((120 + 120*.8),(120 + 120*.2))),
                     offer = "Geplant")

# plan for intervention:: per canten and cycle: meat: 45, vegetarian: 30, hot and cold: 30, vegan: 7, vegan+: 8
# plan for basis:: per canteen and cycle: meat: 60, vegetarian: 30, hot and cold: 30

df_plan_7 <- tibble(year = rep(2017, times=360),
                    label_content = rep(c("Fleisch","Vegetarisch","Pflanzlich","Pflanzlich+"), times=c(180,120,28,32)),
                    offer= "Geplant")

# Actual: Locals are included
# use documentation for that (not selling data)
# exclude hot and cold (only using filter() is deleting missing cases!)
df_actual_7 <- info_orig %>% filter(!grepl("Hot and Cold", info_orig$label_content)) %>% mutate(offer = "Angebot", year = year(date)) %>%
    select(year,label_content,offer)
    
# Merge data frames
df_t= bind_rows(df_plan_56, df_plan_7, df_actual_7)

# Group data frame
df_ <- df_t %>%
    group_by(year,label_content, offer) %>%
    summarise(tot=n()) %>%
    ungroup() # otherwise dataframe is still grouped

# define some variables
df_$xlab <- paste(df_$year,df_$offer, sep = "\n")
df_$xlab <- str_replace(df_$xlab,"2015\nGeplant","2015 - 2016\nGeplant")
df_$label_content <- ifelse(is.na(df_$label_content),"Unbekannt",df_$label_content)

# define text for annotation
text <- group_by(df_, year, offer) %>%
    summarise(tot=sum(tot)) %>%
    mutate(label = "n") %>%
    mutate(label2=paste(label,tot,sep=" = "))

## check if the background color is dark or not
# see mytheme for function
# my colors for the plot
ColsPerCat=c("Unbekannt" = "black","Pflanzlich"="grey90", "Pflanzlich+"="#80ccff", "Vegetarisch" = "#c5b87c", "Fleisch" = "#fad60d","Hot and Cold"="#4c4848")

df_$label_color <- as.factor(sapply(unlist(ColsPerCat)[df_$label_content], # takes every label and their belonged color
                                     function(color) { if (isDark(color)) 'white' else 'black' })) # check if color is dark, than give back "white" else "black"


#plot in de
ggplot(df_, aes(y=tot,x=xlab, fill=factor(label_content,levels=c("Unknown","Pflanzlich","Pflanzlich+","Vegetarisch","Fleisch","Hot and Cold")), color=label_color)) +
    geom_bar(stat="identity", position = "stack", color=NA, width = .5) +
    xlab() + #"\nGeplante und angebotene Menü-Optionen während Herbstsemester (Kalenderwochen 40 bis 51)"
    ylab("Geplante und angebotene Menü-Optionen")+ # title: 
    #     ggtitle("note: locals are not included
    #          selling time between 9 a.m. until 3 p.m.
    #          locals meals in total: 2602")+
    guides(fill=F,
           color=F)+
    # scale_y_continuous(labels = scales::percent)+
    scale_fill_manual(values = ColsPerCat,
                      breaks = attributes(ColsPerCat)$name,
                      labels = c("Unbekannt","Vegan (Fleischsubstitut)","Pflanzlich (authentisch)","Vegetarisch","Fleisch oder Fisch", "Hot and Cold"))+
    scale_color_manual(values = levels(df_$label_color))+
    scale_x_discrete(limits=c("2015 - 2016\nGeplant","2017\nGeplant","2017\nAngebot"))+
    geom_text(aes(label=ifelse(tot>4,tot,"")), size = 8, position = position_stack(vjust = 0.5))+ #omit numbers to be shown smaller than 190
    annotate("text",x=1:3,y=500,label=c(text$label2[1],text$label2[1],text$label2[2]), size=8)+
    mytheme
```

Die Abbildung \ref{fig:fig2} zeigt für die Herbstemester die kalkulierte Planung von 2015 und 2016 als auch das geplante Angebot des Quasi-Experiments im HS 2017. Die dritte Säule zeigt die tatsächlich angebotene Auswahl für das HS 2017.
Das geplante Angebot und das tatsächliche Angebot im HS 2017 unterscheiden sich in den Menü-Inhalten^[Fleisch oder Fisch, Vegetarisch, Vegan (authentisch) und Vegan (Fleischsubstitut)] nicht statisch ( `r apa(chi_s`) ($\chi^2$(3) = `r round(chi_s$statistic[[1]], digits = 3)`, *p* = `r round(chi_s$p.value[[1]], digits = 3)`). Auch beim näheren Betrachten unterschieden sich die geplanten und tatsächlichen Angeboten für das HS 2017 in den Menü-Inhalten zwischen den Basis- (`r apa(chi_s2)`) ($\chi^2$(3) = `r round(chi_s2$statistic[[1]], digits = 3)`, *p* = `r round(chi_s2$p.value[[1]], digits = 3)`) und Interventionswochen (`r apa(chi_s3`) ($\chi^2$(3) = `r round(chi_s3$statistic[[1]], digits = 3)`, *p* = `r round(chi_s3$p.value[[1]], digits = 3)`) nicht. 
\par
Wird das tatsächliche Angebot näher beleuchtet, wurden in über alle Interventionenwochen (*n* = 238) 40 Prozent fleischhaltige, knapp einem Drittel vegetarische und 27 Prozent vegane Gerichte angeboten. In den 12 Basiswochen (*n* = `r 480-238`) entiehlten $\frac{2}{3}$ Prozent des Angebots Fleisch oder Fisch. Vegetarische Gerichte machten rund 29 Prozent und vegane Gerichte knapp 1 Prozent aus. Im Vergleich zu den vergangenen Herbstsemestern 2015 & 2016 wuchs das vegetarische und vegane Angebot im Herbstsemester 2017 von `r ((30*.2)+30)/90*100` Prozent auf knapp 47 Prozent, wobei das Hot and Cold-Buffet nicht als vegetarisches Angebot mitgezählt wurde. 
<!-- überprüfe nochmals ob das so stimmt -->
\newpage

#### 4.2 Was wurde verkauft?

Die totalen Verkaufszahlen des Herbstsemesters 2017 haben sich im Vergleich zu den zwei HS 2015 & 2016 nur marginal verändert. Die Abbildung \ref{fig:fig3} zeigt alle verkauften Gerichten nach Menü-Inhalt, welche während des Quasi-Experiments verkauft wurden.

```{r fig.cap="\\label{fig:fig3} Die Abbildung zeigt alle verkauften Gerichten (*N* = 26'234) aufgeteilt nach den fünf Menü-Inhalten über die 12 Wochen", fig.height=18, fig.width=25, dpi=200, out.width='100%'}

# to load data first execture 04_load_data
#prepare data for plot: aggregated data => locals are included
df_ <- group_by(df_agg, condit ,week, label_content )%>% summarise(tot_sold=n())

df_ <- df_ %>% 
    group_by(week,condit) %>% # give in variable, you want to calculate percentage
    mutate(pct=(tot_sold/sum(tot_sold)))

# ranem NA to unknown
df_$label_content <- ifelse(is.na(df_$label_content),"Unknown",df_$label_content)

# annotation for selling per week
text <- group_by(df_agg, week) %>% summarise(tot = n()) %>%
    mutate(label = "italic(n)") %>%
    mutate(label2 = paste(label, tot, sep="=="))

# define x-lab for plot
df_$xlab <- paste(df_$week, df_$condit, sep = "\n")


## check if the background color is dark or not
# see mytheme for function
# my colors for the plot
ColsPerCat=c("Unknown" = "black","Pflanzlich" = "grey90", "Pflanzlich+" = "#80ccff", "Vegetarisch" = "#c5b87c", "Fleisch" = "#fad60d","Hot and Cold"="#4c4848")
 
# detects dark color: for labelling the bars
isDark <- function(color) {
    (sum(grDevices::col2rgb(color) *c(299, 587,114))/1000 < 123)
}

df_$label_color <- as.factor(sapply(unlist(ColsPerCat)[df_$label_content], # takes every label and their belonged color
                                    function(color) { if (isDark(color)) 'white' else 'black' })) # check if color is dark, than give back "white" else "black"

# barplot
p <- ggplot(df_, aes(y = pct,x = as.factor(xlab), fill = factor(label_content, c("Unknown", "Pflanzlich", "Pflanzlich+", "Vegetarisch", "Fleisch", "Hot and Cold")), color = label_color)) + 
    geom_bar(stat = "identity", position = "fill", color = NA, width = .6) + # set color NA otherwise error occurs
    xlab("Herbstsemesterwochen (Kalenderwochen 40 bis 51)") +
    # xlab(cat('"winter semester weeks (Basis: "','meat','" week, Intervention: "','vegetarian','" week"'))+
    ylab("\nVerkaufte Menüs in Prozent")+
    guides(fill = guide_legend("Menü-Inhalt\n"),
           color = F)+
    scale_y_continuous(labels=scales::percent)+
    scale_fill_manual(values = ColsPerCat,
                      breaks = attributes(ColsPerCat)$name,
                      labels = c("Unbekannt","vegan (Fleischersatz)", "vegan (authentisch)", "ovo-lakto-vegetarisch", "Fleisch oder Fisch", "Hot and Cold"))+
    scale_color_manual(values = levels(df_$label_color))+
    geom_text(aes(label=ifelse(pct*100>1.5,paste0(round(pct*100, digits=0),"%"),"")),size = 8, position = position_stack(vjust = 0.5))+ # omit 0% with ifelse()
    annotate( 
        "text",x = 1:12, y = 1.03, label = text$label2,parse=T, size=9) + # why so big differences to the first version
    mytheme

p + labs(caption = "Daten: Kassendaten SV Schweiz (2017)")

```

```{r, results="hide", comment=F, fig.show="hide"}
# test if week sellings statistically differ
# jürgen dengler said: if the variances are not 4 times bigger than the other variance => go with the parametric statistics otherwise do some checking for the non-parametric statistics (they have also requirements)

sell_dat <- df_agg %>%
    mutate(day=wday(date, label = T)) %>% 
    group_by(semwk, condit) %>%
    summarise(tot_sold=n())

ao=(aov(sell_dat$tot_sold ~ sell_dat$condit)) 
t.test(sell_dat$tot_sold ~ sell_dat$condit) # same as aov
summary(ao)

# test if meal content differ statistically
sell_dat <- df_agg %>%
    mutate(label_content2 = str_replace_all(.$label_content, "Pflanzlich\\+", "Vegan")) %>% # change name 
    mutate(label_content2 = str_replace(.$label_content2, "Pflanzlich", "Vegan")) %>% # change name
    group_by(semwk, condit, label_content2) %>%
    summarise(tot_sold=n()) %>%
    na.omit()  # omit NA, another better way is drop_na()
    #filter(!label_content2 == "Hot and Cold")

ao <- aov(sell_dat$tot_sold ~ sell_dat$label_content2: sell_dat$condit) # anova only with interaction between label_content and condit
library(ggfortify)
autoplot(ao) # dont look very nice, however i would accept it :)
summary(ao) # display anova
TukeyHSD(ao) #post-hoc test


#kruskal wallis test: a robust alternative to anova, however has also requirements
sell_dat$label_content2 <- factor(sell_dat$label_content2, levels = c("Fleisch", "Vegetarisch", "Vegan", "Hot and Cold")) # define independent variable as factor
kr <- kruskal.test(tot_sold ~ interaction(label_content2,condit), data = sell_dat) # it looks like a sign difference between selling melas and interaction label_content and condition
library(FSA)
dunnTest(tot_sold ~ interaction(label_content2,condit), data=sell_dat, # post-hoc-test for kruskal tests
              method="bh") # Benjamini-Hochberg method for correction

# only fleisch.basis and fleisch.intervention are sig different, most of the difference is because hot and cold sellings are low (basis and intervention) compared to the other two

```

Der Abbildung \ref{fig:fig3} ist zu entnehmen, dass die wöchentlichen Verkaufszahlen im HS 2017 sich statistisch nicht unterscheiden (*F*(1,10) = `r round(summary(ao)[[1]][["F value"]][1], digits = 3)`, *p* < .001). Des Weiteren gab es Unterschiede in den Verkaufszahlen zwischen den Basis- und Interventionswochen (*H*(7) = `r round(kr$statistic[[1]], digits = 2)`, *p* < .001). Neben den schwankenden verkaufszahlen der Fleischgerichte, fällt es auf, dass vegane authentische Gerichte deutlich besser verkauft wurden als vegan fleischsubstitituierte Gerichte.   

\newpage

#### 4.3 Wurden in den Interventionswochen auch mehr vegetarischen Gerichten verkauft?

Wird ein grösseres und vielfältigeres Angebot an attraktiven vegetarischen und veganen
Gerichten von den Mensabesuchern häufiger gewählt? Die Abbildung \ref{fig:fig4} zeigt, dass es keine statistischen Unterschiede in den Verkaufszahlen beim Hot and Cold und im vegetarischen Angebot zwischen den beiden Bedingungen Basis & Intervention gab. Auffallend sind die Unterschiede im Verkauf von Fleischgerichten, welche deutlich seltener in den Interventionswochen als in den Basiswochen verkauft wurden. Dass sich mehr vegane Gerichte in den Interventionswochen gekauft wurden lag daran, dass es in den Basiswochen lediglich ein kleines veganes Angebot gab.

```{r, fig.cap="\\label{fig:fig4} Die Abbildung zeigt die verkauften Gerichten nach Menü-Inahlt und Bedingung (Intervention- und Basiswochen)", fig.height=10, fig.width=14}

# visualize findings from above
m_sell <- na.omit(sell_dat) %>% group_by(condit,label_content2) %>% summarise(val = mean(tot_sold)) # calculate means (per what) of the label_content per condition

ggplot(sell_dat, aes(x = condit, y = tot_sold, color = label_content2)) + 
    geom_point(data = m_sell, aes(y = val)) +
    geom_line(data = m_sell, aes(y = val, group = label_content2), size = 2) + 
    theme_bw()+
    labs(y = "Durchschnittlich verkaufte Gerichte pro Woche", x = "Bedingungen") + 
    guides(color = guide_legend(title = "Menü-Inhalt"))+
    scale_color_manual(values = c("Fleisch" = "#fad60d", "Vegetarisch" = "#c5b87c", "Vegan" = "#80ccff", "Hot and Cold" = "#4c4848"),
                       breaks = c("Fleisch", "Vegetarisch", "Vegan", "Hot and Cold"), 
                       limits = c("Fleisch", "Vegetarisch", "Vegan", "Hot and Cold")) + 
    scale_y_continuous(breaks = seq(0,1400,200), limits = c(0, 1400)) +
    mytheme
```


#### 4.4 Lassen sich vegetarische Gerichte auch teuerer verkaufen?

Sind die aktuellen Menü-Linien tatsächlich ein veraltetes Konzept? Nebst der Änderung im Angebot, war eine weitere Intervention die Gerichte über neutrale Menü-Gefässe sog. Menü-Linien zu vertreiben. Für das Quasi-Experiment wurde die Menü-Linie Green zu World unbenannt. Die Menü-Inhalte wurden randomisiert über diese drei Menü-Linien angeboten. Die Abbildung \ref{fig:fig5} vergleicht die Verkaufszahlen gemessen an den Menü-Linien der Jahren 2015, 2016 und 2017.

```{r, fig.cap="\\label{fig:fig5} Die Abbildung zeigt die verkauften Gerichten nach Menü-Linien im Vergleich (2015, 2016 und 2017)", fig.height=10, fig.width=14}

# prepare data
df <- menu_tot %>%
    group_by(article_description, year) %>%
    summarise(tot_sold = sum(tot_sold))

# change first some strings
df$article_description[grep("Local+",df$article_description)] <- "Local" # summarize all locals
df$article_description[grep("Green",df$article_description)] <- "Green/World"
df$article_description[grep("World",df$article_description)] <- "Green/World"

# aggregate again because of locale

df <- df %>% group_by(article_description, year) %>%
    summarise(tot_sold = sum(tot_sold))

df <- df %>% # calculate percentage
    group_by(year) %>% mutate(pct = tot_sold/sum(tot_sold))


## check if the background color is dark or not
# see mytheme for function
# my colors for the plot
ColsPerCat=c("Local" = "black","Favorite"="#c5b87c", "Green/World" = "#fad60d", "Kitchen" = "#008099","Hot and Cold"="#4c4848")

df$label_color <- as.factor(sapply(unlist(ColsPerCat)[df$article_description], # takes every label and their belonged color
                                    function(color) { if (isDark(color)) 'white' else 'black' })) # check if color is dark, than give back "white" else "black"

# define annotation
text <- group_by(df, year) %>% summarise(tot=sum(tot_sold)) %>%
    mutate(tot2=format(tot, big.mark = "'", scientific = F)) %>% # add thousand seperator
    mutate(label = "n") %>%
    mutate(label2=paste(label,tot2,sep=" = "))

# plot data
ggplot(df, aes(y=tot_sold,x=as.factor(year), fill=factor(article_description,levels=c("Local","Kitchen","Green/World","Favorite","Hot and Cold")), color = label_color)) +
    geom_bar(stat="identity", position = "stack", color=NA, width = .6) +
    #ggtitle("Verkaufte Menüs: 3. + 4. HSW\n") +
    xlab("Herbstsemester (Kalenderwochen 40 bis 51)") +
    ylab("Verkaufte Menüs pro Herbstsemester")+
    guides(fill= guide_legend(title = "Menü-Linien"), 
           color=F)+
    scale_fill_manual(values = ColsPerCat,
                      breaks = attributes(ColsPerCat)$names,
                      labels = c("Local/Zusatzangebot","Kitchen","Green/World","Favorite","Hot and Cold"))+
    scale_color_manual(values = levels(df$label_color))+
    geom_text(aes(label=ifelse(pct*100>2,paste0(round(pct*100, digits=0),"%"),"")), size = 6, position = position_stack(vjust = 0.5))+ # omit 1% annotation
    annotate("text",x = 1:3, y = 27500, label = text$label2, size=6)+
    mytheme


```


Die Abbildung \ref {fig:fig5} zeigt, dass es zwischen den drei Herbstsemestern klare Unterschiede in den Verkauszahlen zwischen den Menü-Linien gab. Die Grafik zwar lässt keine Schlüsse über deren Menü-Inhalt zu, aber die randomisierte Ausgabe der Gerichte konnte aufzeigen, dass es einen Einfluss auf die Menü-Wahl genommen hat. So wurden auch vegetarischen Gerichte auf der teureren Menü-Linie «Kitchen» problemlos von den Gästen gekauft.

\newpage

###	5. Diskussion

Nach unserem Wissen wurde noch kein Real-Labor-Experiment durchgeführt, welches die Reaktion der Gäste auf ein ressourcenschonenderes Angebot aufzeichnete. Es gibt einige Untersuchungen wobei mittels Quasi-Experimenten getestet wurde wie die Mensagäste auf bestimmte Labels (z. B. zu gesunder Ernährung oder umweltfreundlichen Gerichten) [@hoefkens_what_2012; @spaargaren_consumer_2013; @thorndike_2-phase_2012], auf Präsentationen oder Positionierung von Nahrungsmitteln [@wansink_slim_2013; @van_kleef_healthy_2012] oder auf soziale oder injuktive Normen [@collins_two_2019] reagierten.
\par
Zusammengefasst zeigen die Ergebnisse dieser Studie, dass eine Erhöhung des vegetarischen und veganen Angebots in Kombination mit neutralen Menü-Lienien und einer randomisierten Ausgabe des Menü-Inahlts zu einer Senkung des Fleischkonsums führen könnten. Ob nun die randomisierte Ausgabe, die neutralen Menü-Linien oder die quantitative Erhöhung von vegetarische und vegane Gerichten für diesen Effekt zuständig ist, bedarf es an weiteren Untersuchungen. Ein weiterer Einflussfaktor könnte das vergrösserte Angebot, welches durch das Caternig Unternehmen generiert wurde, darstellen. Weiter konnte in diesem Quasi-Experiment die qualitative Gleichwertigkeit der täglich angebotenen Gerichte nicht überprüft werden, was gegebenenfalls bei dem Kauf eines Gerichts einen Einfluss nehmen könnte. Zudem basieren die gezeigten Ergebnisse auf aggregierte Verkaufszahlen. 
\par
Gemäss früheren Studien [siehe @blanchette_determinants_2005; @neumark-sztainer_factors_1999; @van_kleef_exploiting_2015 evtl noch buch aufführen von @rozin_1_2007] führt eine höhere Verfügbarkeit, z. B. von gesundem Essen, auch zu einem Einfluss auf das Ernährungsverhalten. Auch in neuren Studien [@ensaff_food_2015] scheint die Verfügbarkeit als Nudging-Strategie eine Veränderung im Kaufverhalten von pflanzenbasierten Nahrungsmitteln hervorzurufen. Auf unser Quasi-Experiment angewendet, konnte eine Erhöhung von ressourcenleichteren Gerichten resp. eine erhöhte Verfügbarkeit davon, einen ähnlichen Effekt hervorrufen, dass mehr vegetarische und vegane Gerichte resp. weniger fleischhaltige Gerichte verkauft wurden. Eine weitere Erklärung unserer Erbegnissen könnte die Erhöhung der Auswahl von Menü-Inhalten sein. Aschemann-Witzel und Kollegen [-@aschemann-witzel_effects_2013] fanden heraus, dass eine Erhöhung der Auswahlmenge einen Einfluss auf das gesunde Wahlverhalten nimmt. Eine Kaufentscheidung zu verstehen und demnach zu beeinflussen ist sehr komplex, denn wir fällen wir über 200 Essensentscheide pro Tag [@wansink_mindless_2007]. Es zeigt sich aber immer mehr, dass die meisten Entscheide anhand einfachen Heuristiken sog. Faustregeln gefällt werden [siehe @scheibehenne_fast_2007]. Inwiefern die Intervention auch tatsächlich einen Einfluss auf das Wahl-Verhalten nimmt, wird in einem separaten Ergebnisthemenblatt untersucht (siehe Egeler & Baur, 2018b). 
\par
Ein weiteres spannendes Ergebniss dieses Quasi-Experiment war, dass in den Interventionswochen die veganen authentische Gerichte sich besser verkauften, als die veganen Gerichte mit Fleischsubstituten. Frühere Studien zeigten, dass der Gerichte-Kontext (z. B. Ingredienzen) einen starken Einfluss auf den Konsum von Fleischsubstituten nimmt [@elzerman_consumer_2011]. Zudem ist die Akzeptanz von Fleischsubstituten immernoch relativ klein [siehe @hoek_will_2010; @de_boer_merits_2011].
\par
Obwohl die Menü-Linien resp. Menü-Labels oftmals für die Gästeführung eingeführt werden, konnte im Quasi-Experiment aufgezeigt werden, dass durch die Wahl von neutralen Menü-Linien und eine randomisierte Ausgabe der Gerichte auch teurere vegetarische und vegane Gerichte von den Mensabesucher gekauft werden. Auch in der Literatur wird kontrovers disskutiert, ob Labels überhaupt einen Einfluss auf die Menü-Wahl nehmen [siehe @spaargaren_consumer_2013; @kiszko_influence_2014; @aschemann-witzel_effects_2013].



###	6. Schlussfolgerungen

Eine Erhöhung von Anzahl und Anteil an vegetarischen und veganen Gerichten in Kombination mit neutralen Menü-Linien und randomisierter Ausgabe der drei Menü-Inhalten (Fleisch oder Fisch, vegetarisch und vegan), scheint den Konsum von Fleischgerichten zu reduzieren. An diesem Punkt ist es wichtig zu erwähnen, dass die vegetarischen und veganen Gerichte diskret neben anderen Inhaltsstoffen deklarieren und nicht angepriesen werden sollten. Um den Gast vermehrt dazu führen, sich mit dem Menü-Inahlt auseinanderzusetzten, alte Gewohnheiten fallen zu lassen und Neophobie zu verkleienrn, sollten die Gerichte unabhängig von Menü-Inahlt randomisierung über alle Menü-Linien anbegoten werden.
\par
Wenn es um den einzelnen Verkauf von Gerichten geht, scheinen authentische Gerichte besser als Gerichte mit Fleischsubstitute abzuschneiden. Daher nicht nur Fleischsubstitute anbieten und wenn Fleischsubstitute angeboten werden, sollte auf den Menü-Kontext geachten werden. Zudem zeigte sich, dass auch vegetarische und vegane Gerichte auf der teureren Menü-Linie "Kitchen" ebenfalls von den Gästen akzeptiert und gekauft wurden. 
\par
In diesem Quasi-Experiment konnte nicht die qualitative Gleichwertigkeit der angebotenen Gerichte berücksichtigt werden. Wird zum Beispiel ein Fleischburger mit Pommes und ein vegetarisches Linsen-Dahl von den Mensabesuchern resp. von Koch-Experten als gleichwertig wahrgenommen? Bei einem weiteren Mensa-Experiment sollte die Gleichwertigkeit der Gerichte bei der Angebotsentwicklung mittels Fachleuten oder Koch-Experten berücksichtigt werden.
\par
Mit diesem Quasi-Experiment konnte gezeigt werden, dass sich die Verkaufszahlen über die Zeit durch eine Erhöhung des vegetarischen und veganen Angebots nicht zurückgegangen sind. Das speziellen Setting und die spezielle Stichprobe haben bestimmt dafür beigetragen, nichtsdestotrotz wären weitere Pilotstudien an anderen Kantinen mit anderen Stichproben resp. Mensabesuchern wünschenswert.

Weitere Informationen zum Projekt können auf unserer [Webpage](novanimal.ch) gefunden werden. 

###	7. Danksagung

Wir bedanken uns bei der SV Schweiz und insbesondere bei den konkreten Verantwortlichen (Area- und Restaurantmanager und Küchenteam) für die hilfsbereite und unkomplizierte Unterstützung (Lieferung von Daten, Rezepturen, Beantwortung von Fragen).

### 8. Hinweise des Autors

Alle Skripte für diesen Bericht sind auf [github](https://github.com/GAEgeler/tilldata_2017) verfügbar.

### 9. Quellen